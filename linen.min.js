var Linen=class{constructor(t){this.canvas=null,this.elements=[],this.dpi=144,this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingQuality="high",this.elements=[]}addElement(t){if("function"!=typeof Linen[t])return console.log("cannot addElement ",t),console.log(t," is ",typeof Linen[t]),!1;{const e=new Linen[t](this);return this.elements.push(e),e}}context(){return this.ctx}render(){this.elements.sort(function(t,e){return t.settings.zindex>e.settings.zindex}),this.elements.map(t=>{t.render()})}};Linen.Model=class{constructor(t){this.Linen=t,this.dimensions={x:0,y:0,width:"100%",height:"100%"},this.settings={alignment:"left",bold:!1,fillStyle:"#000000",filter:"none",fontFamily:"Arial",fontSize:"12pt",globalAlpha:1,italic:!1,lineCap:"butt",lineDashOffset:0,textLineHeight:1.2,lineJoin:"miter",lineWidth:1,miterLimit:10,shadowBlur:0,shadowColor:"#000000",shadowOffsetX:0,shadowOffsetY:0,strokeStyle:"#000000",textAlign:"left",textBaseline:"top",v_alignment:"top",zindex:1},this.fill=!1,this.stroke=!1}dpi(){return this.Linen.dpi}width(){return this.getDimensionPx("width")}height(){return this.getDimensionPx("height")}x(){var t=this.getDimensionPx("x"),e=this.width();switch(this.getDimension("alignment")){case"center":return t-e/2;case"right":return t-e}return t}y(){const t=this.getDimensionPx("y"),e=this.height();switch(this.settings.v_alignment){case"middle":return t-e/2;case"bottom":return t-e}return t}setWidth(t){return this.setDimension("width",t)}setHeight(t){return this.setDimension("height",t)}setX(t){return this.setDimension("x",t)}setY(t){return this.setDimension("y",t)}setXY(t,e){return this.setX(t).setY(e)}setAlignment(t){return this.setSetting("alignment",t.toLowerCase())}center(){return this.setAlignment("center")}setVAlignment(t){return this.setSetting("v_alignment",t.toLowerCase())}middle(){return this.setVAlignment("middle")}setFill(t){return this.setProp("fill",t)}setStroke(t){return this.setProp("stroke",t)}getDimension(t){return this.dimensions[t]||null}getDimensionPx(t){const e=this.getDimension(t);if(null===e)return 0;switch(typeof e){case"string":return this.translateDimension(e,t);case"function":return e(this);case"number":return e;default:return 0}}setDimension(t,e){return this.dimensions[t]=e,this}getSetting(t){return this.settings[t]||null}setSetting(t,e){return this.settings[t]=e,this}setProp(t,e){return this[t]=e,this}context(){return this.Linen.context()}translateDimension(t,e=""){return this.translateToPx(t,e)}translateToPx(t,e=""){if("string"!=typeof t)return t;const i=t.match(/^([0-9.]+)([^0-9]+)/i),s=parseFloat(i[1]);switch(i[2].toLowerCase()){case"%":return Math.round(this.percentage(s,e));case"pt":return Math.round(s*(this.dpi()/72));case"in":return Math.round(s*this.dpi());default:return s+"px"}}percentage(t,e=""){const i=t/100;var s=0;switch(e){case"width":case"x":case"x2":s=this.context().canvas.width;break;case"height":case"y":case"y2":s=this.context().canvas.height;break;default:return 0}return i*s}render(){Object.assign(this.Linen.ctx,this.settings),this.setFont()}setFillStyle(t){return this.setSetting("fillStyle",t)}setFilter(t){return this.setSetting("fillter",t)}setFont(){const t=[this.settings.bold?"bold ":"",this.settings.italic?"italic ":"",this.settings.fontSize+"px"," ",this.settings.fontFamily];return this.context().font=t.join(""),this.setSetting("font",t.join(""))}setGlobalAlpha(t){return this.setSetting("globalAlpha",t)}setLineCap(t){return this.setSetting("lineCap",t)}setLineJoin(t){return this.setSetting("lineJoin",style)}setLineWidth(t){return this.setSetting("lineWidth",this.translateToPx(t))}setMiterLimit(t){return this.setSetting("miterLimit",t)}setShadowBlur(t){return this.setSetting("shadowBlur",t)}setShadowColor(t){return this.setSetting("shadowColor",t)}setShadowOffsetX(t){return this.setSetting("shadowOffsetX",this.translateToPx(t))}setShadowOffsetY(t){return this.setSetting("shadowOffsetY",this.translateToPx(t))}setStrokeStyle(t){return this.setSetting("strokeStyle",t)}setTextAlign(t){return this.setSetting("textAlign",t)}setTextBaseline(t){return this.setSetting("textBaseline",t)}},Linen.Rectangle=class extends Linen.Model{constructor(t){super(t)}render(){super.render(),this.context().beginPath();var t=super.width(),e=super.height(),i=super.x(),s=super.y();this.context().rect(i,s,t,e),this.fill&&this.context().fill(),this.stroke&&this.context().stroke()}},Linen.Arc=class extends Linen.Model{constructor(t){super(t),this.radius=1,this.startAngle=0,this.endAngle=2*Math.PI,this.anticlockwise=!1,this.offsetXY=!0}setRadius(t){return this.setProp("radius",t)}render(){super.render(),this.context().beginPath(),this.dimensions.width=this.dimensions.height=2*this.radius;var t=super.x(),e=super.y();this.offsetXY&&(t+=this.radius,e+=this.radius),this.context().arc(t,e,this.radius,this.startAngle,this.endAngle,this.anticlockwise),this.fill&&this.context().fill(),this.stroke&&this.context().stroke()}},Linen.Image=class extends Linen.Model{constructor(t){super(t),this.dimensions.width=0,this.dimensions.height=0,this.img=new Image}setSrc(t){return this.img.src=t,this}render(){super.render(),this.img.addEventListener("load",function(){this.drawImage()}.bind(this),!1)}drawImage(){var t=super.width(),e=super.height();t<1&&(t=this.dimensions.width=this.img.width),e<1&&(e=this.dimensions.height=this.img.height);var i=super.x(),s=super.y();this.context().drawImage(this.img,i,s,t,e)}},Linen.Line=class extends Linen.Model{constructor(t){super(t),this.dimensions.x2=this.dimensions.y2=0}setCords(t,e,i,s){return this.setDimension("x",t),this.setDimension("y",e),this.setDimension("x2",i),this.setDimension("y2",s),this}render(){super.render();var t=super.x(),e=super.y(),i=super.getDimensionPx("x2"),s=super.getDimensionPx("y2");this.context().beginPath(),this.context().moveTo(t,e),this.context().lineTo(i,s),this.context().stroke()}},Linen.Text=class extends Linen.Model{constructor(t){super(t),this.wrap=!1,this.text=""}setWrap(t){return this.setProp("wrap",t)}setText(t){return this.setProp("text",t)}setFontFamily(t){return this.setSetting("fontSize",t)}setFontSize(t){return this.setSetting("fontSize",this.translateToPx(t))}render(){super.render();var t=this.text.split("\n"),e=this.x(),i=this.y();this.setFont(),this.wrap?t=this.wrapLines(t):this.width()>0&&this.fitTextWidth(t),this.height()>0&&this.fitTextHeight(t),t.map(t=>{this.writeLine(t,e,i),i+=this.textHeight(t)})}fitTextWidth(t){var e=!0;if(this.settings.fontSize<=1)return!0;var i=this.width();if(t.map(t=>{this.textWidth(t)>i&&(e=!1)}),e)return!0;this.settings.fontSize-=1,this.setFont(),this.fitTextWidth(t)}fitTextHeight(t){var e=!0;if(this.settings.fontSize<=1)return!0;var i=0;if(t.map(t=>{i+=this.textHeight(t)}),i>this.height()&&(e=!1),e)return!0;this.settings.fontSize-=1,this.setFont(),this.fitTextHeight(t)}textWidth(t){return this.context().measureText(t).width}textHeight(t){return this.settings.fontSize*this.context().textLineHeight}writeLine(t,e,i){var s=super.width();super.height(),this.textWidth(t);switch(this.context().textAlign){case"center":e+=Math.round(s/2);break;case"right":e+=s}this.fill&&this.context().fillText(t,e,i),this.stroke&&this.context().strokeText(t,e,i)}wrapLines(t){var e=[];const i=this.width();return t.map(t=>{var s="";t.split(" ").map(t=>{this.textWidth(s+t+" ")>i?(e.push(s),s=t+" "):s+=t+" "}),e.push(s)}),e}};