var Linen=class{constructor(t=!1){switch(this.elements=[],this.dpi=144,typeof t){case"object":this.canvas=t;break;case"string":this.canvas=document.querySelector(t);break;default:this.canvas=document.createElement("canvas")}this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingQuality="high",this.elements=[]}addElement(t){if("function"!=typeof Linen[t])return console.log("cannot addElement ",t),console.log(t," is ",typeof Linen[t]),!1;{const e=new Linen[t](this);return this.elements.push(e),e}}setWidth(t){return this.canvas.width=t,this}setHeight(t){return this.canvas.height=t,this}getUrl(t="image/png"){return this.canvas.toDataURL(t)}context(){return this.ctx}render(){this.elements=this.elements.sort(function(t,e){return t.settings.zindex>e.settings.zindex?1:t.settings.zindex<e.settings.zindex?-1:0}),this.renderQueued()}renderQueued(){if(this.elements.length>0){this.elements.shift().render().afterRender()}}};Linen.Model=class{constructor(t){this.Linen=t,this.dimensions={x:0,y:0,width:"100%",height:"100%"},this.settings={alignment:"left",bold:!1,fillStyle:"#000000",filter:"none",fontFamily:"Arial",fontSize:"12pt",globalAlpha:1,italic:!1,lineCap:"butt",lineDashOffset:0,textLineHeight:1.2,lineJoin:"miter",lineWidth:1,miterLimit:10,shadowBlur:0,shadowColor:"#000000",shadowOffsetX:0,shadowOffsetY:0,strokeStyle:"#000000",textAlign:"left",textBaseline:"top",v_alignment:"top",zindex:1},this.fill=!1,this.stroke=!1,this.clip=!1,this.trasform=!1,this.callback=function(){}}dpi(){return this.Linen.dpi}width(){return this.getDimensionPx("width")}height(){return this.getDimensionPx("height")}x(){var t=this.getDimensionPx("x"),e=this.width();switch(this.settings.alignment){case"center":return t-e/2;case"right":return t-e}return t}y(){const t=this.getDimensionPx("y"),e=this.height();switch(this.settings.v_alignment){case"middle":return t-e/2;case"bottom":return t-e}return t}setWidth(t){return this.setDimension("width",t)}setHeight(t){return this.setDimension("height",t)}setX(t){return this.setDimension("x",t)}setY(t){return this.setDimension("y",t)}setXY(t,e){return this.setX(t).setY(e)}setAlignment(t="left"){return this.setSetting("alignment",t.toLowerCase())}center(){return this.setAlignment("center")}setVAlignment(t="top"){return this.setSetting("v_alignment",t.toLowerCase())}middle(){return this.setVAlignment("middle")}setTransorm(t=1,e=0,s=0,i=1,n=0,r=0){return this.setProp("transform",{a:t,b:e,c:s,d:i,e:n,f:r})}setFill(t=!0){return this.setProp("fill",t)}setStroke(t=!0){return this.setProp("stroke",t)}setClip(t=!0){return this.setProp("clip",t)}setDimension(t,e){return this.dimensions[t]=e,this}getSetting(t){return this.settings[t]||null}setSetting(t,e){return this.settings[t]=e,this}setProp(t,e){return this[t]=e,this}setFillStyle(t){return this.setSetting("fillStyle",t)}setFilter(t){return this.setSetting("fillter",t)}setFont(){const t=[this.settings.bold?"bold ":"",this.settings.italic?"italic ":"",this.settings.fontSize+"px"," ",this.settings.fontFamily];return this.context().font=t.join(""),this.setSetting("font",t.join(""))}setGlobalAlpha(t){return this.setSetting("globalAlpha",t)}setLineCap(t){return this.setSetting("lineCap",t)}setLineJoin(t){return this.setSetting("lineJoin",style)}setLineWidth(t){return this.setSetting("lineWidth",this.translateToPx(t))}setMiterLimit(t){return this.setSetting("miterLimit",t)}setShadowBlur(t){return this.setSetting("shadowBlur",t)}setShadowColor(t){return this.setSetting("shadowColor",t)}setShadowOffsetX(t){return this.setSetting("shadowOffsetX",this.translateToPx(t))}setShadowOffsetY(t){return this.setSetting("shadowOffsetY",this.translateToPx(t))}setStrokeStyle(t){return this.setSetting("strokeStyle",t)}setTextAlign(t){return this.setSetting("textAlign",t)}setTextBaseline(t){return this.setSetting("textBaseline",t)}setCallback(t){return this.setProp("callback",t)}context(){return this.Linen.context()}getDimension(t){return this.dimensions[t]||null}getDimensionPx(t){const e=this.getDimension(t);if(null===e)return 0;switch(typeof e){case"string":return this.translateToPx(e,t);case"function":return e(this);case"number":return e;default:return 0}}translateToPx(t,e=""){if("string"!=typeof t)return t;const s=t.match(/^([0-9.]+)([^0-9]+)/i),i=parseFloat(s[1]);switch(s[2].toLowerCase()){case"%":return Math.round(this.percentage(i,e));case"pt":return Math.round(i*(this.dpi()/72));case"in":return Math.round(i*this.dpi());default:return i+"px"}}percentage(t,e=""){const s=t/100;var i=0;switch(e){case"width":case"x":case"x2":i=this.context().canvas.width;break;case"height":case"y":case"y2":i=this.context().canvas.height;break;default:return 0}return s*i}render(){if(Object.assign(this.Linen.ctx,this.settings),this.setFont(),this.context().resetTransform(),"object"==typeof this.transform){const t=this.transform;this.context().transform(t.a,t.b,t.c,t.d,t.e,t.f)}return this}afterRender(){return this.clip&&this.context().clip(),this.runCallback(),this.Linen.renderQueued(),this}runCallback(){return this.callback()}},Linen.Rectangle=class extends Linen.Model{constructor(t){super(t)}render(){super.render(),this.context().beginPath();var t=super.width(),e=super.height(),s=super.x(),i=super.y();return this.context().rect(s,i,t,e),this.fill&&this.context().fill(),this.stroke&&this.context().stroke(),this}},Linen.Arc=class extends Linen.Model{constructor(t){super(t),this.radius=1,this.startAngle=0,this.endAngle=2*Math.PI,this.anticlockwise=!1,this.offsetXY=!0}setRadius(t){return this.setProp("radius",t)}render(){super.render(),this.context().beginPath(),this.dimensions.width=this.dimensions.height=2*this.radius;var t=super.x(),e=super.y();return this.offsetXY&&(t+=this.radius,e+=this.radius),this.context().arc(t,e,this.radius,this.startAngle,this.endAngle,this.anticlockwise),this.fill&&this.context().fill(),this.stroke&&this.context().stroke(),this}},Linen.Image=class extends Linen.Model{constructor(t){super(t),this.dimensions.width=0,this.dimensions.height=0,this.img=new Image,this.loaded=!1}setSrc(t){return this.img.src=t,this}render(){return super.render(),this.img.addEventListener("load",function(){console.log("Image loaded: ",this.img.src),this.drawImage(),this.runCallback(),this.Linen.renderQueued()}.bind(this),!1),this}afterRender(){}drawImage(){var t=super.width(),e=super.height();t<1&&(t=this.dimensions.width=this.img.width),e<1&&(e=this.dimensions.height=this.img.height);var s=super.x(),i=super.y();this.context().drawImage(this.img,s,i,t,e)}},Linen.Line=class extends Linen.Model{constructor(t){super(t),this.dimensions.x2=this.dimensions.y2=0}setCords(t,e,s,i){return this.setDimension("x",t),this.setDimension("y",e),this.setDimension("x2",s),this.setDimension("y2",i),this}render(){super.render();var t=super.x(),e=super.y(),s=super.getDimensionPx("x2"),i=super.getDimensionPx("y2");return this.context().beginPath(),this.context().moveTo(t,e),this.context().lineTo(s,i),this.context().stroke(),this}setAlignment(t){return console.log("`alignment` is currently not supported on Line element."),this}},Linen.Text=class extends Linen.Model{constructor(t){super(t),this.wrap=!1,this.text=""}setWrap(t=!0){return this.setProp("wrap",t)}setText(t){return this.setProp("text",t)}setFontFamily(t){return this.setSetting("fontFamily",t)}setFontSize(t){return this.setSetting("fontSize",this.translateToPx(t))}setBold(t=!0){return this.setSetting("bold",t)}setItalic(t=!0){return this.setSetting("italic",t)}setTextLineHeight(t){return this.setSetting("textLineHeight",t)}render(){super.render();var t=this.text.split("\n"),e=this.x(),s=this.y();return this.setFont(),this.wrap?t=this.wrapLines(t):this.width()>0&&this.fitTextWidth(t),this.height()>0&&this.fitTextHeight(t),t.map(t=>{this.writeLine(t,e,s),s+=this.textHeight(t)}),this}fitTextWidth(t){var e=!0;if(this.settings.fontSize<=1)return!0;var s=this.width();if(t.map(t=>{this.textWidth(t)>s&&(e=!1)}),e)return!0;this.settings.fontSize-=1,this.setFont(),this.fitTextWidth(t)}fitTextHeight(t){var e=!0;if(this.settings.fontSize<=1)return!0;var s=0;if(t.map(t=>{s+=this.textHeight(t)}),s>this.height()&&(e=!1),e)return!0;this.settings.fontSize-=1,this.setFont(),this.fitTextHeight(t)}textWidth(t){return this.context().measureText(t).width}textHeight(t){return this.settings.fontSize*this.context().textLineHeight}writeLine(t,e,s){var i=super.width();super.height(),this.textWidth(t);switch(this.context().textAlign){case"center":e+=Math.round(i/2);break;case"right":e+=i}this.fill&&this.context().fillText(t,e,s),this.stroke&&this.context().strokeText(t,e,s)}wrapLines(t){var e=[];const s=this.width();return t.map(t=>{var i="";t.split(" ").map(t=>{this.textWidth(i+t+" ")>s?(e.push(i),i=t+" "):i+=t+" "}),e.push(i)}),e}},Linen.Canvas=class extends Linen.Model{constructor(t){super(t),this.canvas=null}setCanvas(t){return this.setProp("canvas",t)}render(){super.render();var t=super.width(),e=super.height();t<1&&(t=this.dimensions.width=this.canvas.width),e<1&&(e=this.dimensions.height=this.canvas.height);var s=super.x(),i=super.y();return this.context().drawImage(this.canvas,s,i),this}},Linen.Path=class extends Linen.Model{constructor(t){super(t),this.paths=[]}addPath(t){return this.paths.push(new Path2D(t)),this}render(){return super.render(),this.context().translate(this.x(),this.y()),this.paths.map(t=>{this.context().beginPath(),this.fill&&this.context().fill(t),this.stroke&&this.context().stroke(t),this.clip&&this.context().clip(t)}),this}afterRender(){return this.Linen.renderQueued(),this}};